#再访侧链白皮书——《用楔入式侧链实现区块链创新》

original paper: https://www.blockstream.com/sidechains.pdf
	
2014-10-22

	作者：Adam Back（密码货币先驱，BlockStream CEO）
	
	Matt Corallo（比特币核心开发者）
	
	Luke Dashjr
	
	Mark Freidenbach（比特币开发者）
	
	Gregory Maxewll（比特币核心开发者）
	
	Andrew Miller
	
	Andrew Poelstra
	
	Jorge Timon（比特币开发者）
	
	Pieter Wuille（BlockStream，比特币核心开发者）


#引言
1983年，David Chaum将数字现金作为一个研究课题首次提出，通过设置一个可信的中央服务器，来防止双花（双重花费）。为降低这个中央可信方带给个人的隐私风险，并确保资产的可替代性(fungibility)，Chaum引入了盲签名——提供一种密码手段，来防止关联中央服务器的签名，同时仍然让中央服务器进行双花防范。对中央服务器的需求，是数字现金的致命弱点。虽然有可能通过将中央服务器的签名替换为含几个签名者的门限签名，来分散单点故障，但区分和辨识签名者（的身份）对于可审计性变得很重要（**译者注：这里的意思是说如何识别和区分门限签名是不是真的门限签名，门限签名中，签名者必须是不同的主体，否则，被一个主体控制下的门限签名也只是空有门限签名的外壳**）。在这种方法下，系统仍然易出故障，因为每个签名者都可能会出问题，或者是一个接一个地被人为制造出问题。

译者注：**第一段主要讲了传统电子现金方案的不足，最大的不足是依赖中心化服务器**。

2009年1月，中本聪发布了第一个广泛使用的点对点无信任电子现金系统，用基于工作量证明的共识机制来替代中央服务器的签名，用经济上的激励实现协同工作。比特币通过将交易聚合成区块的方法来跟踪支付，每个区块关联有一个区块头(blockheader)，用密码学方法来指代(承诺)：区块的内容、时间戳、前一个区块头。到前一区块头的“指代”(commitment)构成了区块链，或者说是提供了一个明确交易次序的链。(**译者注：在密码学中，commitment，即承诺，指的对原始数据用密码算法进行处理，生成的摘要可以在不泄露原文的情况下可以有效地代指原始数据。一个典型的承诺方案或协议需满足计算绑定性和完美隐藏性。代表有Pedersen承诺方案。**)

我们注意到，比特币系统的区块头可以看作是动态成员多方签名(或称DMMS)的一个实例，我们认为它作为群签名的一种新类型，有独立的价值。尽管截止目前的文献中尚未提及，比特币系统提供了这种签名的第一个实施方案。一个“动态成员多方签名”(DMMS)是由一组数量**不固定**的签名者所形成的数字签名。

比特币系统的区块头是DMMS，因为其工作量证明机制具有让任何人无需登记即可贡献算力的性质。此外，贡献量不是让每个参与方提供一个门限签名，而是通过计算力来衡量，这允放使用匿名成员身份，并且不会有女巫攻击(Sybil attack)的风险(一个参与方多次加入，获取在签名中不相称的输入份额)。基于这个原因，DMMS也被描述为是拜占庭将军问题的一个解决方案。

由于区块是链接在一起的，比特币系统的DMMS是累积的：任何一个区块头的链(或链的片断)都是第一个块的DMMS，其计算强度等于组成它的全部DMMS之和。**中本聪的关键创新就是如上所述的使用了基于计算力的DMMS签名，而不是基于知识的签名**。由于签名者是证明其计算量（computational work），而不是典型数字签名中的证明其私密知识（**译者注：即签名者私钥**），我们称这样的签名者为“矿工”。为了实现对区块链历史记录的稳定共识，系统提供了经济激励，只有当矿工们构建了可共享的有效历史记录，他们获取的钱币形式的交易费和奖励才会有价值，这激励他们诚实地工作。因为比特币的累积DMMS强度与所有矿工们贡献的计算力成正比，算力占少数的一方想改变链是行不通的。如果他们试图修改受DMMS保护的账本，他们就会落后，并且一直无法追上达成共识的区块链的进度。

由于矿工们并没有形成一个（身份）可辨识的集体，因此他们对决定交易有效性的规则没有自由裁量权。因此，比特币的规则必须在它的历史初期就要确定，除非每个网络参与者达成一致，否则新的有效交易类型无法添加进来。即使能达成这样的一致，变更的部署实施也很困难，因为这需要所有参与者都要用相同方式落实和执行新的规则，还要考虑到边缘情况以及其他因素导致的意外的影响。

##创新的需求

正因如此，比特币系统的目标相对简单：它是一个支持单一原生数字资产转让的区块链，不能与其他任何资产相兑换。

这可以简化很多具体实现，不过这样的简化正面临着现实世界需求的挑战。尤其是，目前的创新主要围绕在以下几个方面：

1、在可扩展性和去中心化间的取舍。例如，更大的区块可以支持更高的交易速率，代价是加大了验证方的工作量——中心化的风险。

同样，在安全性和成本之间也存在取舍。比特币历史记录中用同等级别的不可逆性存储了每一笔交易。这种方式的维护代价很高，对低价值和低风险的交易来说也未必合适(例如，所有参与方已经商定了一个共同的法律机构来处理欺诈行为)。

由于不同交易的价值和风险状况有很大的不同，这样的取舍应当针对每笔交易来应用。然而比特币系统的构建仅支持以一个标准来应对所有问题。

2、在区块链的功能上存在更多的取舍。例如，是让比特币的脚本更强大来支持简明和有用的合约，还是减少功能以便于审计。

3、一些非货币的资产也可以在区块链上交易，例如欠条（IOUs）、其它合约和智能财产。

4、存在一元化育成的风险:比特币系统由许多密码学组件构成，其中的任何一个组件出问题，都会导致整体价值的损失。如果有可能，不要用同一套算法来保护每个比特币会更谨慎些。

5、新技术可能会带来比特币系统创建初期没有想到的新功能。例如，用密码累加器、环签名或Chaumian盲签名来增强隐私和抗审查性。

6、即使有这样做的迫切需求，但没有对比特币系统安全升级的途径，这意味着任何更改都需要所有参与者协同执行才能生效。比特币的开发者们之间达成了一个共识，对比特币系统的变更必须缓慢、谨慎，且仅当社区有明确同意时才进行。
　　
实际上，由于功能必须被广泛认可后才能采纳，这限制了参与者的个人自由和对其钱币的自主性。小的团体无法实现诸如专用脚本扩展这样的功能，因为他们缺少广泛的共识。

##侧链产生的原因

早期针对比特币系统中这些问题的解决方案是开发可替代的区块链，又称竞争链(altchains)，除针对上述关注点有所修改外，共用了比特币系统的代码库。然而，靠创建一个独立的但本质上类似的系统来实现技术变更，是存在问题的。
　　
问题一，基础架构碎片化：由于每个竞争链都使用自己的技术栈，经常会有重复性或遗失的工作。因此，由于竞争链的实现者可能并未扫除比特币系统中安全特定领域知识的障碍，安全问题常常跨竞争链被复制，而它们的修复也不解决这些问题。必须消耗大量资源或是建立专家评价评审新的分布式加密系统，如果没这样做，安全隐患常常无法察觉，直到漏洞被利用。结果是，我们看到了一种动荡的、无法前航的发展环境，大部分显现出来的项目可能在技术上是最不健全的。打个比方，想象一下在互联网上，每个网站使用自已的TCP实现，将自定义的检验和和数据包拼接算法广播给最终用户。这不会是一个能生存的环境，这也不是竞争链能生存的环境。

问题二，这样的竞争链和比特币系统一样，通常有自己的带有浮动价格的原生密码货币，或称竞争币。为了使用竞争链，用户需要通过一个市场来获取这种货币，这将使他们直接面对新货币带来的高风险和波动。此外，因为有独立解决初始分配和估值问题的需求，与此同时还要在不良的网络效应与拥挤的市场中竞争，这既阻碍了技术创新，又助长了市场的博弈。这危及的不仅仅是这些系统的直接参与者，还危及到整个密码货币行业。如果这一领域被公众认为风险过高，对密码货币的采纳可能会受阻，或者有可能完全被遗弃(自愿或立法上)。

这表明我们希望有一个环境来让可互操作的竞争链能易于创建和使用，但不要产生不必要的市场和开发碎片。在本文中，我们认为这些看似矛盾的目标有可能同时实现。核心考察点是 “Bitcoin” 这一区块链在概念上是独立于“bitcoin”这一资产：如果我们能在技术上支持区块链间资产的移动，可以通过简单地复用现有比特币的方式，开发出用户可能会采纳的新系统。

##楔入式侧链（pegged sidechains）


我们称这种可互操作的区块链为“楔入式侧链”。 我们将在下一章中给出精确的定义，这里先列出以下“楔入式侧链”所需具备的属性。

1、在侧链间移动的资产应当能够被当前持有者移回，但除此之外的任何人则不行(包括前持有者)。

2、资产的移动应当无交易对手风险（couterparty risk）;也就是说，不诚实的一方无法阻止转移的发生。

3、资产转移应当是元操作(原子操作)，即，要么完全完成，要么根本不发生。不应存在会导致资产损失或允许欺诈产生的失败模式。

4、侧链应当设有防火墙：一个会使某条链发生资产铸造(或偷盗)的缺陷(bug)，不应导致任何其他链出现资产的铸造或偷盗。

5、区块链重组时应当处理干净，即使在资产转移的期间也要如此;任何破坏应当只发生在它所处的侧链上。总的来说，理想情况下，侧链应当完全独立，来自其他链上的全部所需数据由用户提供。侧链的验证者应当只有在侧链本身的显式共识规则有要求时，才需要跟踪其他链。

6、不应要求用户去跟踪他们未主动使用的侧链。

早期“转移”钱币的解决方案是用一个可公开识别的方式来销毁比特币，让新的区块链能检测到，以允许铸造新币。这解决了部分上面提到的问题，但由于这种方法只允许单向转移，因此还不足以满足我们的目的(译者注：这也称作单向锚定（one-way peg）)。

我们提出的方案是由资产转移的交易本身提供所有者证明（proof of possession）来转移资产，避免让节点有跟踪发送方链的需求。从上层实现角度，当资产从一个区块链向另一个链移动时，我们在第一个区块链上创建交易锁定资产，然后在第二个区块链上创建一笔交易，该交易的输入中包含一个锁定已正确完成的密码学证明。这些输入用某种资产类型来标记，比如创生出资产的区块链的创世哈希(genesis hash)。

第一个区块链我们称之为父链，每二个则简单称为侧链（sidechain）。在某些模型中，两条链可对称地来处理，因此这一术语应当看成是相对的。从概念上讲，我们打算将资产从(初始)父链转移到一条侧链，可能会再转移到别的侧链，最终还能转回至父链，并保全初始资产。一般我们把父链看成是比特币系统，侧链是其他区块链中的某一个。当然，侧链的币(coin)也可以在侧链间转让，并非只能与比特币系统进行往来;不过，由于任何一个最初从比特币系统移动的币都可以移回去，所以不管变成什么样，它仍是个比特币。

这让我们解决了前面章节提到的碎片化问题，对只想专注于技术创新的开发者来说是个好消息。

此外，由于侧链是从父链中转移现有资产而不是另铸新资产，侧链不会引起未经授权的铸币，维护其资产的安全和稀缺性依靠父链来实现。

更进一步说，参与者不必再担心他们的持有物会被一个实验性竞争链锁往，因为侧链币能够用等额的父链币来赎回。这提供了一个退出机制，减少因软件无人维护而造成的损失。

另一方面，由于侧链仍然是一个独立于比特币系统的区块链，它们可以自由地实验新的交易设计、信任模型、经济模型、资产发行语义，或密码特性。我们将在第5节中进一步探讨一些侧链的可能性。

这一基础架构的额外好处是对比特币系统本身进行改变不再那么迫切：与其策划一个需要各方均达成一致并一起实施的分叉，不如用侧链来创建一个新的“改变了的比特币系统”。从中期看，如果广泛认可新系统有进步，最终会明显看到，相对于比特币父链，更多的人会使用这个新系统。由于父链的共识规则没有任何修改，任何人都可以根据自己的时间去切换，不会有任何因共识失败所带来的风险。从更长期看，如果父链被认为，或当父链需要改变时，侧链的成功将给父链的更改提供了所需的信心。


#设计原理


“无需信任”(trustlessness)指的不依赖外部的可信方也可完成正确操作的特性，一般是能够让所有参与方自己验证信息是否正确。例如，密码学签名系统中，“无需信任”是一个隐式的必要条件(如果攻击者能伪造签名，那么这个签名系统将被视为被完全破解)。虽然分布式系统中一般不需如此，但比特币在系统的大部分中提供了“无信任”操作。(**译者注：比特币通过使用动态成员多方签名和经济激励减少信任需求，但并没去除信任。比特币只是不再依赖一个外部的可信方，但比特币信任密码算法，信任人都是自利的**)

**“楔入式侧链”的一个主要设计目标是在比特币系统模型之上最小化附加的信任。****难点是币在侧链间的安全转移：接收链必须能得知发送链的币已被正确锁定。**在比特币的领导下，我们提议用DMMS来解决这一问题。尽管有可能利用一个简单基于信任的方案，即引入固定数量签名者来验证币的锁定，但有很多重要理由让我们避免引入这种单点故障：

1. 信任单个签名者，并**不仅仅**意味期待他们做事诚实，他们**还**必须永远不出漏洞、永远不会泄露关键的秘密、永远不会被挟持、永远不会停止参与网络。

1. 由于数字资产是长期存在的，对任何信任的要求也必须如此。经验告诉我们，即使时间跨度只有几个月，信任需求也是一种危险的期待，更何况我们所期望的金融系统所能持续的时间长达几个世代。

1. 在比特币系统消除了单点故障前，数字货币一直没有什么吸引力，社区强烈反对引入这种弱点（即存在一个中央服务器）。2007年以来的金融事件更加强了社区的不信任;对金融系统和其他公共机构的公共信任也同样处于历史的低点。　　


#双向锚定（Two-way peg）


楔入式侧链（pegged sidechain）的技术基础称作**双向锚定（或双向楔入）**。本节我们将解释它是如何工作的，先给出一些定义。


##定义

币(coin)，或资产，是一种可以用密码学方法确定（数字资产）控制者的数字财产。

区块（block），是一个描述资产控制发生变化的交易的集合。（**译者注：简单理解就是交易的集合**）

区块链（blockchain），是一个有序次的区块的集合，所有用户必须(或最终)对该集合达成共识。这确定了资产控制的历史，提供了一个计算上无法伪造的交易时序。

重组（reorganization），或称reorg，发生在客户端本地，当先前已接受的链被一个有更多工作量证明的竞争链取代时，分叉上失败一方的区块要从共识历史中移除。（**译者注：按照比特币协议规范，矿工默认在工作量最难的链头部追加区块，另一条链上分叉出去的块成为孤块，作废！因为是分布式系统，每个节点看见的链尾部一般是不一样的**）

侧链（sidechain），是验证来自其他区块链数据的区块链。（**译者注：侧链也是区块链**）

双向锚定（two-way peg），指的是让币以一个固定或确定性的汇率在侧链间转出和转入的**机制**。（**译者注：双向锚定本质上是一种机制**）

楔入式侧链（pegged sidechain），是一条侧链，其链上的资产可以从其他链导入并返还;即，一条支持双向楔入资产的侧链。

简单支付验证证明(或称SPV证明)，是一种动态成员多方签名(DMMS)，发生于一条类比特币系统工作量证明(proof-of-work)区块链上。


本质上，**SPV证明****是由一个展示工作量证明的(a)区块头列表，和一个(b)表明某一输出发生在列表中的某一个区块的密码学证明所组成**。这使验证者可以检查是否有一定数量的工作量已经认可了某个输出的存在。当有其他证明(proof)展示了一条工作量更多的链，且生成该输出区块未包含于其中时，其他证明会使这一证明失效。

使用SPV证明来确定交易历史，隐含着要信任最长的区块链也是最长的正确区块链，在比特币系统中，这是由一个被称为SPV的客户端实现的。由于诚实的哈希算力不会为一个无效链去贡献工作量，只有当超过50%的哈希算力合谋时，才会始终欺骗SPV客户端(除非客户端处于长期的女巫攻击之下，使其无法看到实际的最长链)。

还可以这样做，通过获取每个区块头来指代区块链上未花费输出的集合，任何拥有SPV证明的人不需要“中继”(relay)每个区块也能确定链的状态。(在比特币系统中，完全验证者第一次开始跟踪区块链时需要做这种中继。)

通过在比特币系统的区块结构中包含一些额外数据，我们可以生成比区块头完整列表更小的证明(proofs)，从而提高可扩展性。尽管如此，这样的证明还是比普通的比特币交易要大得多。幸好对于大多数资产转移来说，这并不是必要的：每条链的持币人可以直接使用元互换(原子交换)操作进行汇兑。


注：SPV SPV证明


##对称式双向楔入（Symmetric two-way peg）



我们可以利用这些想法将一个侧链SPV楔入至另一个侧链。这包含以下工作：为了将父链币转移为侧链币，父链币被发送到父链上的一个特殊输出中，该输出只能由侧链上拥有的一个SPV证明来解锁。为了在两条链上进行同步，我们需要定义两个等待周期：

1、侧链间转移的确认周期，是指币在转移至侧链之前，在父链上必须被锁定的周期。此确认周期目的是生成足够多的工作量，让下一个等待周期内的拒绝服务攻击变得更困难。典型的确认周期的量级可以是一或两天。

当父链上创建了特殊输出后，用户等待确认期结束，然后在侧链上创建一个引用该输出的交易，提供出一个它已被创建并在父链上被足够工作量覆盖的SPV证明。

确认期是一个依侧链而定的安全参数，要在跨链交易速度和安全性间做权衡。

2、接下来，用户必须等待一个竞赛期（contest period）。这个期间，新转移过来的币不能在侧链上花费。竞赛期的目的是防止重组时出现双花，在重组期间转走先前锁定的币。在这个延迟期内的任何时刻，如果有一个新的工作证明发布出来，对应的有着更多累计工作量的链中没有包含那个生成锁定输出的区块，那么该转换将被追溯为失效。我们称此为重组证明。

只要有可能，所有侧链上的用户都会有动力来制发重组证明，因为对不良证明的承认会稀释所有币的价值。

典型的竞赛期也是一或两天的量级。为了避免这些延迟，用户很可能用元互换(原子交换)(在附录C中有描述)进行大多数交易，只要有流动性的市场可用。

当币在父链上被锁定时，该币可以在侧链内自由转移，不需要与父链进一步交互。不过，它仍保留着父链币的身份，仅能转回到它所来的那一条链上。

当用户想把币从侧链上转回父链时，与原先转移所用的方法相同：在侧链上将币发送至一个SPV锁定的输出，产生一个充分的SPV证明来表明该输出已完成，使用这个证明来解锁父链上先前被锁定的那个等面值的输出。

图1展示了整个转移过程（省略）

由于楔入式侧链可能会从很多链中搬运资产，且无法对这些链的安全性做出假定，因此，不同资产不可相互兑换是非常重要的(除非是一个显示声明的交易)。否则，恶意用户可以通过创建一条资产毫无价值的无价值链进行偷盗，将这样一种资产移到一个侧链，再把它和别的东西去兑换。为了应对这种情况，侧链必须有效地将不同父链中的资产处置为不同的资产类型。

总之，我们提议让父链和侧链相互做数据的SPV验证。由于不能指望父链客户端能看到每条侧链，为了证明所有权，用户必须从侧链导入工作量的证明到父链。在对称式双向楔入中，反向的操作也是如此。

为了让比特币系统成为父链，需要有一个能识别和验证SPV证明的脚本扩展。最起码的要求是，这种证明需要做得足够小，以便能放进比特币系统一个交易之中。不过，这只是一个软分叉，对于不使用新功能的交易不会产生影响。


##非对称式双向楔入（Asymmetric two-way peg）

上节以“对称式双向楔入”作为标题，是因为**从父链向侧链的转移机制与反方向的机制是相同**：都拥有SPV安全性。（译者注：这意味着信任矿工不创建无效的块）
　　

另一种方案是非对称式双向楔入：这种方式下，侧链上的用户对父链能完全验证，由于所有的验证者都知道父链的状态，从父链向侧链的转移不需要SPV证明。另一方面，由于父链并不知道有侧链，所以转回到父链时需要有SPV证明。

这对安全性有所促进，现在，即使一个51%攻击者也没法错误地将币从父链转移到侧链。不过，相应的代价是迫使侧链的验证者去跟踪父链，同时也意味着发生在父链上的重组也可能导致侧链上的重组。在这里，我们不详细探讨这种可能性，因为围绕重组的议题会导致复杂度显著扩大。
